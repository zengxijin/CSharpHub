--住院患者列表(未结算)
SELECT IP_REGISTER.REG_NO,	--住院流水号
         IP_REGISTER.IP_NO,   	--住院号
         IP_REGISTER.IP_CNT,   	--次数
         IP_REGISTER.FEE_CODE,  --费用类别(11农合)
         IP_REGISTER.NAME,   	--患者名称
         IP_REGISTER.IP_DATE,   --入院日期
         IP_REGISTER.OP_DATE,   --出院日期
         IP_REGISTER.OP_DEPT,   --出院科室
         (select card_no from PATIENTINFO where PATIENTINFO.PID=ip_register.pid) as card_no, --卡号
         CODE_FEE.FEE_NAME,   	--费用类别名称
         CODE_DEPARTMENT.DEPT_NAME,   --出院科室名称
         IP_REGISTER.OP_TIME ,	--出院时间
 IP_REGISTER.LOC_FLAG  		--状态(1:在院,2:科室出院)
    FROM IP_REGISTER,   
         CODE_FEE,   
         CODE_DEPARTMENT  
   WHERE
         ( IP_REGISTER.FEE_CODE = CODE_FEE.FEE_CODE ) and  
         ( IP_REGISTER.OP_DEPT = CODE_DEPARTMENT.DEPT_CODE(+) ) and  
         ( ( IP_REGISTER.LOC_FLAG in ('1','2') ) AND  
         ( IP_REGISTER.CHRG_FLAG <> '3' ) )   
and (trim(IP_REGISTER.FEE_CODE) in ('11'))
order by ip_no

--住院明细
select 
b.ip_no,	--住院号
a.item_code,	--HIS项目编码
price,		--HIS项目单价
qty,		--HIS项目数量
total,		--HIS项目总价格
bill_time,	--记账时间
pre_no,		--医嘱编号
a.up_flag,	--上传标志
standard,	--规格
small_unit,	--单位
(select item_cls from code_item where item_code=a.item_code ) as item_cls,	--项目类型(1,2,3:药品 4,5,6,7,8,9:其他)
(select item_name from code_item where item_code=a.item_code ) as item_name 	--项目名称
from
IP_BILL a left join IP_REGISTER b on a.reg_no=b.reg_no ,plus_item c
where  
c.item_code=a.item_code and c.type=3 and a.reg_no='住院流水号'
order by bill_time,a.item_code


--住院上传回车病人住院号查询
SELECT IP_REGISTER.REG_NO,	--住院流水号
         IP_REGISTER.IP_NO,   	--住院号
         IP_REGISTER.IP_CNT,   	--次数
         IP_REGISTER.FEE_CODE,  --费用类别(11农合)
         IP_REGISTER.NAME,   	--患者名称
         IP_REGISTER.IP_DATE,   --入院日期
         IP_REGISTER.OP_DATE,   --出院日期
         IP_REGISTER.OP_DEPT,   --出院科室
         (select card_no from PATIENTINFO where PATIENTINFO.PID=ip_register.pid) as card_no, --卡号
         CODE_FEE.FEE_NAME,   	--费用类别名称
         CODE_DEPARTMENT.DEPT_NAME,   --出院科室名称
         IP_REGISTER.OP_TIME ,	--出院时间
         IP_REGISTER.LOC_FLAG  		--状态(1:在院,2:科室出院)
    FROM IP_REGISTER,   
         CODE_FEE,   
         CODE_DEPARTMENT  
   WHERE
         ( IP_REGISTER.FEE_CODE = CODE_FEE.FEE_CODE ) and  
         ( IP_REGISTER.OP_DEPT = CODE_DEPARTMENT.DEPT_CODE(+) ) and  
         ( ( IP_REGISTER.LOC_FLAG in ('1','2') ) AND  
         ( IP_REGISTER.CHRG_FLAG <> '3' ) )   
and (trim(IP_REGISTER.FEE_CODE) in ('11'))  and IP_REGISTER.ip_no = '"+ query +"'